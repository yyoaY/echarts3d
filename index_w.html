<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <title>echarts 3D earth</title>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
    <link href="roll2.css" id="css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="http://jqueryui.com/resources/demos/style.css">
    <style>
        html{height:100%;}
        body{
            height:100%;
            margin:0;
            background:url('img/timg.png') center/cover no-repeat;
        }
    		h1{
    			color:#FFF;
    		}
    		p{
    			color:#FFF;
                text-align: right;
    		}
        #text{
            width: 450px;
        }
        #history{
            position: absolute;
            height: 50px;
            width: 500px;
            background-color:rgba(43,43,43,0.9);
            bottom:-10%;
            left:430px;
        }
        #history ul {
            list-style-type:none;
            margin:10px;
            padding:0;
            padding-bottom:15px;
            padding-top:22px;
            color:white;
            font-size:16px;
            font-family:'Roboto';
            background:url('img/timelineBG.png') -10px -10px no-repeat;
        }
        #history ul li {
            width:90px;
            height:50px;
            float:left;
            text-align:center;
            cursor:pointer;
        }
        #history .timeline #handle {
            cursor:pointer;
            width:36px;
            height:36px;
            background:url('img/yearHandle.png') 0px 0 no-repeat;
            position:absolute;
            bottom:10px;
        }
        #hudButtons{
            display: none;
            position: absolute;
            top: 30px;
            width: 489px;

        }
        #hudButtons .countryTextInput {
            float:right;
            font-size:17px;
            width:300px;
            margin-right:5px;
            font-family:'RopaSans';
            text-transform:uppercase;
        }
        #hudButtons .list {
            list-style-type:none;
            background-color: white;
            float: right;
            font-size: 17px;
            width: 266px;
            margin-right: 5px;
            font-family: 'RopaSans';
            text-transform: uppercase;
            margin-top: 0px;
            overflow-y: hidden;
            overflow-x:hidden;
        }
        #hudButtons .list a{
            display: block;
            text-decoration:none;
            padding: 5px;
            color: black;

        }
        #hudButtons .list li{
            display: block;
            width: 305px;
            height: 32px;
            margin-left: -40px;
        }
        #hudButtons .list li:hover{
            display: block;
            cursor: pointer;
            width: 305px;
            height: 32px;
            background: rgba(61,40,104,0.2);
            margin-left: -40px;
        }
        #hudButtons .armsBtn {
            float: right;
            background:#141414;
            padding:3px 10px 2px;
            color:white;
            border:0;
            font-size:18px;
            font-family:'RopaSans';
            cursor:pointer;
            margin-right:0px;
            opacity:0.9;
        }
        #hudButtons .armsBtn:hover {
            opacity: 1;
        }
        #hudButtons .aboutBtn {
            display:block;
            clear:both;
            margin-right:0px;
            width:56px;

        }
        #importExportBtns {
            width:298px;
            position:absolute;
            bottom:0px;
            color:white;
            display:none;
        }
        #importExportBtns>div>div {
            float:left;
            width:60px;
            text-align:center;
            height:28px;
        }
        #importExportBtns .imex>div {
            background:#262626;
        }
        #importExportBtns .typeLabels div {
            font-family:'Roboto';
            font-size:13px;
            text-transform:uppercase;
            margin-bottom:-12px;
        }

        #importExportBtns .imex>div {
            cursor: pointer;
            opacity: 0.9;
        }
        #importExportBtns .imex>div:hover {
            opacity: 1;
        }
        #importExportBtns>div>.label {
            width:58px;
            height:25px;
            text-transform:uppercase;
            font-family:'Roboto';
            font-size:18px;
            margin-left:10px;
            background:#262626;
            vertical-align:middle;
            padding-top:3px;
        }
        #importExportBtns .imports .label {
            color:#44B2D4;
        }
        #importExportBtns .exports .label {
            color:#FFA90B;
        }
        #importExportBtns .imports {
            margin-bottom:5px;
        }
        #importExportBtns .mil, #importExportBtns .civ {
            margin-right:5px;
        }
        #importExportBtns .imex .check {
            width: 16px;
            height: 16px;
            background: #262626 url('img/importExportIcons.png') 0 0 no-repeat;
            margin: 6px auto;
        }
        #importExportBtns .imports .mil .check {
            background-position: 0px 0px;
        }
        #importExportBtns .imports .mil .check.inactive {
            background-position: 0px -16px;
        }
        #importExportBtns .imports .civ .check {
            background-position: -16px 0px;
        }
        #importExportBtns .imports .civ .check.inactive {
            background-position: -16px -16px;
        }
        #importExportBtns .imports .ammo .check {
            background-position: -32px 0px;
        }
        #importExportBtns .imports .ammo .check.inactive {
            background-position: -32px -16px;
        }
        #importExportBtns .exports .mil .check {
            background-position: -48px 0px;
        }
        #importExportBtns .exports .mil .check.inactive {
            background-position: -48px -16px;
        }
        #importExportBtns .exports .civ .check {
            background-position: -64px 0px;
        }
        #importExportBtns .exports .civ .check.inactive {
            background-position: -64px -16px;
        }
        #importExportBtns .exports .ammo .check {
            background-position: -80px 0px;
        }
        #importExportBtns .exports .ammo .check.inactive {
            background-position: -80px -16px;
        }
        #container{
            height:100%;
            box-sizing: border-box;
        }

    </style>
    <script type="text/javascript" src="js/echarts.min.js"></script>
    <script type="text/javascript" src="js/echarts-gl.min.js"></script>
    <script type="text/javascript" src="js/world.js"></script>
    <script type="text/javascript" src="js/jquery.js"></script>
</head>
<body>
    <div id="text">
        <h1>一带一路相关国家间的新闻流通</h1>
        <p>自2015年-2019年3月</p>
    </div>
    <div id="container">
    </div>
    <div id="history">
        <ul class="timeline pointer" id="line">
            <li>2015</li>
            <li>2016</li>
            <li>2017</li>
            <li>2018</li>
            <li>2019</li>
            <div id="handle" class="noMapDrag ui-draggable"style="left: 222px"></div>
        </ul>
    </div>
    <div class="overlayCountries noPointer" id="hudButtons" style="left: 800px; display: block;">
        <input type="button" value="相关" class="aboutBtn armsBtn pointer">
        <input type="button" value="查询" class="searchBtn armsBtn pointer"onclick="copyText()">
        <input type="text" name="country" id="countries"
               class="countryTextInput pointer noMapDrag ui-autocomplete-input" value="中国"
               >
        <ul id="data_list" class="list"></ul>
        <br class="clear">
    </div>
    <div id="importExportBtns" class="overlayCountries" style="left: 1073px; display: block;">
        <div class="typeLabels">
            <div class="mil">正面</div>
            <div class="civ">中性</div>
            <div class="ammo">负面</div><br class="clear">
        </div>
        <div class="imports imex">
            <div class="mil" id="m1"><div class="check"></div></div>
            <div class="civ" id="c1"><div class="check"></div></div>
            <div class="ammo" id="a1"><div class="check"></div></div>
            <div class="label" id="label1">输入</div><br class="clear">
        </div>
        <div class="exports imex">
            <div class="mil" id="m2"><div class="check"></div></div>
            <div class="civ" id="c2"><div class="check"></div></div>
            <div class="ammo" id="a2"><div class="check"></div></div>
            <div class="label" id="label2">输出</div><br class="clear">
        </div>
        <br class="clear">
    </div>

    //情感 点击事件
    <script>
        var ag=1;
        var btnTest1=document.getElementById("label1");
        btnTest1.onclick=function(e)
        {
            var btns = $("#importExportBtns .imports>div").not(".label");
            ag++;
            if (ag%2!=0)
            {btns.find('.check').removeClass('inactive');}
            else
            {btns.find('.check').addClass('inactive');}
        }
        var bg=1;
        var btnTest2=document.getElementById("label2");
        btnTest2.onclick=function(e)
        {
            var btns = $("#importExportBtns .exports>div").not(".label");
            bg++;
            if (bg%2!=0)
            {btns.find('.check').removeClass('inactive');}
            else
            {btns.find('.check').addClass('inactive');}
        }
        var cg=1;
        var btnTest3=document.getElementById("m1");
        btnTest3.onclick=function(e)
        {
            var btns = $("#importExportBtns .imports .mil");
            cg++;
            if (cg%2!=0)
            {btns.find('.check').removeClass('inactive');}
            else
            {btns.find('.check').addClass('inactive');}
        }
        var dg=1;
        var btnTest4=document.getElementById("c1");
        btnTest4.onclick=function(e)
        {
            var btns = $("#importExportBtns .imports .civ");
            dg++;
            if (dg%2!=0)
            {btns.find('.check').removeClass('inactive');}
            else
            {btns.find('.check').addClass('inactive');}
        }
        var eg=1;
        var btnTest5=document.getElementById("a1");
        btnTest5.onclick=function(e)
        {
            var btns = $("#importExportBtns .imports #a1");
            eg++;
            if (eg%2!=0)
            {btns.find('.check').removeClass('inactive');}
            else
            {btns.find('.check').addClass('inactive');}
        }
        var gg=1;
        var btnTest6=document.getElementById("m2");
        btnTest6.onclick=function(e)
        {
            var btns = $("#importExportBtns .exports .mil");
            gg++;
            if (gg%2!=0)
            {btns.find('.check').removeClass('inactive');}
            else
            {btns.find('.check').addClass('inactive');}
        }
        var fg=1;
        var btnTest7=document.getElementById("c2");
        btnTest7.onclick=function(e)
        {
            var btns = $("#importExportBtns .exports .civ");
            fg++;
            if (fg%2!=0)
            {btns.find('.check').removeClass('inactive');}
            else
            {btns.find('.check').addClass('inactive');}
        }
        var hg=1;
        var btnTest8=document.getElementById("a2");
        btnTest8.onclick=function(e)
        {
            var btns = $("#importExportBtns .exports #a2");
            hg++;
            if (hg%2!=0)
            {btns.find('.check').removeClass('inactive');}
            else
            {btns.find('.check').addClass('inactive');}
        }
    </script>

    //查询按钮 点击事件
    <script>
        //查询按钮 点击事件
        function copyText() {
            var country1;
            country1=document.getElementById("countries").value;
            window.location.href="index_w.html"+"?"+"c="+country1+"&"+"y="+yearNum;
        }
    </script>

    //时间条
    <script>
        window.onload = function() {
            var obj_lis = document.getElementById("line").getElementsByTagName("li");
            var year;
            // var l;
            // var le;
            // var len;
            for (i = 0; i < obj_lis.length; i++) {
                obj_lis[i].onclick = function () {
                    year=this.innerHTML;
                    // l=document.getElementById("handle").style.left;
                    // var reg = /\d+/;
                    // len=l.match(reg);
                    // le=(len*1-222)/90+2017;
                    // len=(len*1)+(year-le)*90;
                    // document.getElementById("handle").style.left=len+'px';
                    window.location.href="index_w.html"+"?"+"c="+counName+"&"+"y="+year;
                }
            }
        }
    </script>

    //输入框
    <script>
        var data = [
            "中国", "马达加斯加", "巴拿马", "摩洛哥", "印度",
            "埃塞俄比亚", "新西兰", "波黑", "黑山", "土库曼斯坦",
            "立陶宛","拉脱维亚","巴勒斯坦","阿尔巴尼亚","阿富汗",
            "爱沙尼亚","巴基斯坦","斯洛文尼亚","克罗地亚","黎巴嫩",
            "阿曼","巴林","也门","埃及","约旦","叙利亚","印度尼西亚",
            "菲律宾","缅甸","文莱","东帝汶","不丹","阿联酋","泰国",
            "越南","新加坡","以色列","阿塞拜疆","亚美尼亚","捷克","孟加拉国",
            "白俄罗斯", "柬埔寨","格鲁吉亚","匈牙利","伊拉克","伊朗","吉尔吉斯斯坦",
            "老挝","哈萨克斯坦","卡塔尔","科威特","摩尔多瓦","马尔代夫","马来西亚",
            "马其顿","蒙古国","尼泊尔","波兰","保加利亚","罗马尼亚","塞尔维亚","沙特阿拉伯",
            "斯洛伐克","塔吉克斯坦","俄罗斯","南非","斯里兰卡","韩国","土耳其","乌克兰","乌兹别克斯坦",
            "巴巴多斯","瓦努阿图","汤加","库克群岛","厄瓜多尔","葡萄牙","斐济","密克罗尼西亚联邦",
            "马耳他", "萨尔瓦多","多米尼加","智利","萨摩亚","苏里南","格林纳达","委内瑞拉","多哥","冈比亚",
            "乌干达","佛得角","布隆迪","坦桑尼亚","津巴布韦","刚果（布）","乍得","尼日利亚","肯尼亚",
            "安哥拉", "纳米比亚","加蓬","莫桑比克","赞比亚","加纳","塞舌尔","南苏丹","喀麦隆","塞拉利昂",
            "科特迪瓦", "阿尔及利亚","哥斯达黎加","吉布提","毛里塔尼亚","几内亚","索马里","希腊","乌拉圭",
            "纽埃","多米尼克","圭亚那","卢旺达","塞内加尔","突尼斯","利比亚","巴布亚新几内亚","玻利维亚",
            "安提瓜和巴布达","特立尼达和多巴哥","奥地利","苏丹","意大利","古巴"
        ]
        var ele_key = document.getElementById("countries");
        ele_key.onkeyup = function (e) {

            var val = this.value;

            //获取输入框里匹配的数据
            var srdata = [];
            for (var i = 0; i < data.length; i++) {
                console.log(data[i].indexOf(val))
                if (val.trim().length > 0 && data[i].indexOf(val) > -1) {
                    srdata.push(data[i]);
                }
            }
            var ele_datalist = document.getElementById("data_list");
            ele_datalist.style.visibility = "visible";
            ele_datalist.innerHTML = "";

            if (srdata.length == 0) {
                ele_datalist.style.visibility = "hidden";
            }
            var self = this;
            for (var i = 0; i < srdata.length; i++) {
                var ele_li = document.createElement("li");
                var ele_a = document.createElement("a");
                ele_a.setAttribute("href", "javascript:;");
                ele_a.textContent = srdata[i];

                ele_a.onclick = function () {
                    self.value = this.textContent;
                    ele_datalist.style.visibility = "hidden";
                }


                ele_li.appendChild(ele_a);
                ele_datalist.appendChild(ele_li);
            }
        }
    </script>

    //3d地球
    <script>
        //数据处理
        /*
            记录下起点城市和终点城市的名称，以及权重
            i为终点国家，e为起点国家，以及该国家的权重，就是图上圆圈的大小
         */
        //地球的皮肤
        var canvas = document.createElement('canvas');
        var myChart = echarts.init(canvas, null, {
            width: 4096,
            height: 2048
        });
        //选中国家
        var counName="中国";//国家 初始值“中国”
        //选择年份
        var yearNum=2018;//年份 初始值“2018”

        //解析url
        var url=location.href;
        var tmp1=url.split("?")[1];
        if(tmp1!=null){
            var tmp2=tmp1.split("&")[0];
            var tmp3=tmp1.split("&")[1];
            counName=decodeURI(tmp2.split("=")[1]);//decodeURI解码
            yearNum=tmp3.split("=")[1];

            //设置时间条圆点位置
            var l=document.getElementById("handle").style.left;
            var reg = /\d+/;
            var len=l.match(reg);
            var le=(len*1-222)/90+2017;
            len=(len*1)+(yearNum-le)*90;
            document.getElementById("handle").style.left=len+'px';
        }


        //数据变量
        var dser = [];  // 2D散点坐标系列
        var series = [];// 3D飞线
        var maxsize=10;//散点最大尺寸，即被分析的某国散点尺寸，其他国家散点尺寸按比例设置
        var pointsData=[]; //用于保存每一个需要被筛选的散点名称、经纬度和大小
        var pointsDatav=[]; //用于保存每一个需要被筛选的散点新闻数、经纬度，大小为1
        var vtol=0;//针对某国特定类型的流入或流出新闻总数

        //不同情况的线条颜色，正面为绿色，负面为红色，中性为蓝色
        var lcolor={pos:"#006600",neg:"#CC3333",neu:"#9ae5fc"};

        //各国的经纬度数据
        var geoCoordMap = {
            '中国': [116.404, 39.915],
            '马达加斯加': [47.479371,-18.827917],
            '巴拿马': [-79.351593,9.26581],
            '摩洛哥': [-6.792655,34.107995],
            '印度': [77.099019,28.747507],
            '埃塞俄比亚': [38.685463,9.119557],
            '新西兰': [174.82546,-41.277039],
            '波黑': [18.411642,43.87268],
            '黑山': [19.184329,42.44509],
            '土库曼斯坦': [58.370571,37.991019],

            '立陶宛': [25.292231,54.692755],
            '拉脱维亚': [24.114804,57.050284],
            '巴勒斯坦': [35.206074,31.771513],
            '阿尔巴尼亚': [19.814436,41.380108],
            '阿富汗': [69.192781,34.543017],
            '爱沙尼亚': [24.597733,59.496542],
            '巴基斯坦': [73.093008,33.716842],
            '斯洛文尼亚': [14.47922,46.072787],
            '克罗地亚': [15.951004,45.816092],
            '黎巴嫩': [35.488933,34.054415],

            '阿曼': [58.448759,23.6461],
            '巴林': [50.574716,26.262399],
            '也门': [44.172457,15.386086],
            '埃及': [31.183965,30.108445],
            '约旦': [35.967263,31.96189],
            '叙利亚': [36.261619,33.60915],
            '印度尼西亚': [106.760061,-6.175051],
            '菲律宾': [120.999569,14.65294],
            '缅甸': [96.089629,17.110033],
            '文莱': [114.744488,4.99407],

            '东帝汶': [125.562098,-8.526035],
            '不丹': [89.595383,27.499741],
            '阿联酋': [54.603724,24.406541],
            '泰国': [100.486583,13.863379],
            '越南': [105.785004,21.062193],
            '新加坡': [103.834891,1.481017],
            '以色列': [35.206074,31.771513],
            '阿塞拜疆': [49.930811,40.52929],
            '亚美尼亚': [44.448416,40.219729],
            '捷克': [14.27685,50.124424],

            '孟加拉国': [90.441659,23.832405],
            '白俄罗斯': [27.596492,53.977821],
            '柬埔寨': [104.865139,11.660317],
            '格鲁吉亚': [44.669184,41.780715],
            '匈牙利': [19.133736,47.450773],
            '伊拉克': [44.301238,33.30071],
            '伊朗': [51.292211,35.736894],
            '吉尔吉斯斯坦': [74.472805,42.980999],
            '老挝': [102.583874,18.098099],
            '哈萨克斯坦': [71.455648,51.292566],

            '卡塔尔': [51.512978,25.446698],
            '科威特': [47.907108,29.5148],
            '摩尔多瓦': [28.70033,47.049904],
            '马尔代夫': [73.516145,4.255613],
            '马来西亚': [101.700804,3.294564],
            '马其顿': [21.415001,42.055536],
            '蒙古国': [106.925636,47.922842],
            '尼泊尔': [85.290415,27.860076],
            '波兰': [20.899876,52.318978],
            '保加利亚': [23.181141,42.737368],

            '罗马尼亚': [26.124709,44.501492],
            '塞尔维亚': [20.458341,44.868995],
            '沙特阿拉伯': [46.729681,24.743043],
            '斯洛伐克': [17.054841,48.181879],
            '塔吉克斯坦': [68.935219,38.636067],
            '俄罗斯': [37.512635,55.728904],
            '南非': [28.01963,-25.564709],
            '斯里兰卡': [79.973597,7.001734],
            '韩国': [126.997087,37.706538],
            '土耳其': [32.876517,39.951229],

            '乌克兰': [30.595252,50.419205],
            '乌兹别克斯坦': [69.376754,41.463198],
            '巴巴多斯': [-59.599221,13.129419],
            '瓦努阿图': [168.295599,-17.681198],
            '汤加': [-175.206626,-21.1327],
            '库克群岛': [-159.766694,-21.199574],
            '厄瓜多尔': [-78.535052,-0.146485],
            '葡萄牙': [-9.175547,38.882766],
            '斐济': [178.467682,-18.105884],
            '密克罗尼西亚联邦': [158.161665,6.925909],

            '马耳他': [14.505223,35.899862],
            '萨尔瓦多': [-89.208388,13.706045],
            '多米尼加': [-80.248904,22.58678],
            '智利': [-70.677711,-33.355808],
            '萨摩亚': [-171.706466,-13.891554],
            '苏里南': [-55.19469,5.943586],
            '格林纳达': [-61.714232,12.088437],
            '委内瑞拉': [-66.879273,10.474519],
            '多哥': [1.061944,8.758247],
            '冈比亚': [-15.891165,13.472079],

            '乌干达': [32.548918,0.467073],
            '佛得角': [-23.507646,14.979604],
            '布隆迪': [29.973296,-3.346662],
            '坦桑尼亚': [34.958964,-5.857308],
            '津巴布韦': [30.948353,-17.760259],
            '刚果（布）': [23.221488,-1.903469],
            '乍得': [18.658959,16.032139],
            '尼日利亚': [7.031867,9.31608],
            '肯尼亚': [37.57138,0.541161],
            '安哥拉': [16.819229,-12.110017],

            '纳米比亚': [16.892818,-22.348526],
            '加蓬': [11.557602,-0.644268],
            '莫桑比克': [34.480634,-18.463988],
            '赞比亚': [25.870699,-14.237288],
            '加纳': [-1.136533,7.594194],
            '塞舌尔': [55.453552,-4.676951],
            '南苏丹': [31.520852,5.10074],
            '喀麦隆': [11.465616,3.909217],
            '塞拉利昂': [-11.880554,8.602632],
            '科特迪瓦': [-5.257527,6.850062],

            '阿尔及利亚': [2.515331,28.125468],
            '哥斯达黎加': [-84.154335,10.064525],
            '吉布提': [42.603041,11.77365],
            '毛里塔尼亚': [-11.190655,20.720725],
            '几内亚': [-10.74912,10.774834],
            '索马里': [45.049881,3.465607],
            '希腊': [23.8194,38.016504],
            '乌拉圭': [-55.877689,-32.525353],
            '纽埃': [-169.867341,-18.993713],
            '多米尼克': [-61.395183,15.350947],

            '圭亚那': [-58.985137,5.04078],
            '卢旺达': [29.815711,-2.115772],
            '塞内加尔': [-15.073693,14.684851],
            '突尼斯': [9.836246,34.919426],
            '利比亚': [16.790425,27.233335],
            '巴布亚新几内亚': [143.58629,-6.142244],
            '玻利维亚': [-65.315016,-16.423831],
            '安提瓜和巴布达': [-61.865523,17.141551],
            '特立尼达和多巴哥': [-61.506775,10.6571291],
            '奥地利': [14.558544,47.858269],
            '苏丹': [32.698279,15.649772]
        };

        //根据某行数据转换出飞线中的数据
        var convertData = function(d) {
            var res = [];
            var fromCoord = geoCoordMap[d.e];
            var toCoord = geoCoordMap[d.i];
            if(fromCoord && toCoord) {
                res.push([fromCoord, toCoord]);
            }
            return res;
        }

        //函数功能为设置散点标签为pla，散点大小为size
        function setdserp(pla,size){
            pointsData.push({
                name: pla,    //散点的name为国家名
                value: geoCoordMap[pla], //散点的value为该点的经纬度
                symbolSize: size   //散点对应的大小
                // data:{"数量":100}
            })
        }

        //函数功能为设置散点标签为pla，散点大小为1
        function setdserv(pla,size){
            pointsDatav.push({
                name: size,    //散点的name为国家名
                value: geoCoordMap[pla], //散点的value为该点的经纬度
                symbolSize: 1 ,  //散点对应的大小
                scale:100
            })
        }

        let json = $.getJSON("data/all.json", function (data){
            //函数sel选择需要显示的数据，其中tim表示时间，范围是2015-2019，pla表示地点
            // dir表示方向，取值为"i"或"e"，cla表示类别，取值为"pos"、"neg"、"neu"
            //结果存在dat数组中

            //定义函数，筛选在特定时间，针对某一国家输入或输出特定感情取向的新闻流动数据
            function sel(tim,pla,dir,cla){//tim：时间 pla:国家 dir:流动方向 cla：感情取向
                var dat=[];
                var datain=data.timeBins[tim-2015].data;
                //console.log(datain);

               //筛选出符合条件的数据dat，并计算中心国的流动新闻总数vtol
                for(var i=0;i<datain.length;i++){
                    if(datain[i][dir]==pla&&datain[i].c==cla){
                        dat.push({
                            i:datain[i].i,
                            e:datain[i].e,
                            c:datain[i].c,
                            v:datain[i].v
                        });
                        //计算总输入值
                        vtol+=datain[i].v;
                    }
                }

                //设置被统计国家的地名散点
                setdserp(pla,maxsize);

                //设置被统计国家的数值散点
                setdserv(pla,vtol);


                //对被关联国的新闻流动方向是相反的
                var dirv=(dir=="i")? "e":"i";

                //关联的散点
                for(var i=0;i<dat.length;i++)
                {
                    val=dat[i].v; //每个被关注流动的实际数值
                    //按比例计算散点的大小
                    size=Math.round(maxsize*val/vtol);
                    pla=dat[i][dirv];

                    //设置每个关联国家的地名散点
                    setdserp(pla,size);

                    //设置每个关联国家的数值散点
                    setdserv(pla,val);

                }
                return dat;
            }
            //取数据为****年，国家为**，方向（i：输入，e：输入）
            // 类型（正面：pos，负面：neg，中性：neu)
            //var Data=sel(2015,"中国","i","neg");

            //聚焦某一国家的输出输入情况
            function selectCon(pla){
                var dat=[];
                var datain=data.timeBins[yearNum-2015].data;
                var toli=0,tole=0;
                for(var i=0;i<datain.length;i++){//遍历所有时间
                    if(datain[i].i==pla||datain[i].e==pla){
                        dat.push({
                            i:datain[i].i,
                            e:datain[i].e,
                            c:datain[i].c,
                            v:datain[i].v
                        });
                        //计算总输入值
                        if(datain[i].i==pla)
                          toli+=datain[i].v;
                        else {
                          tole+=datain[i].v;
                        }
                  }
                  //设置被统计国家的地名散点
                  setdserp(pla,maxsize);

                  //设置被统计国家的数值散点
                  //散点数值=输出+输入
                  vtol=toli+tole;
                  setdserv(pla,vtol);
              }
              //关联的散点
              for(var i=0;i<dat.length;i++)
              {
                  val=dat[i].v; //每个被关注流动的实际数值
                  //按比例计算散点的大小
                  if(datain[i].i==pla)
                    size=Math.round(maxsize*val/toli);
                  else {
                    size=Math.round(maxsize*val/tole);
                  }

                  pla=(dat[i].i==pla)?dat[i].e:dat[i].i;

                  //设置每个关联国家的地名散点
                  setdserp(pla,size);

                  //设置每个关联国家的数值散点
                  setdserv(pla,val);

                }

              //console.log(toli);
              return dat;
            }
            //取 “黑山”的输入输出数据
            var Data=selectCon(counName);

            //添加散点数据，第二组为标注数值的散点
            dser.push(
                {
                    type: 'effectScatter',
                    coordinateSystem: 'geo',
                    zlevel: 1000,
                    rippleEffect: {
                        brushType: 'stroke'
                    },
                    label: {
                        fontSize:24, //标签的字号
                        show: true,
                        position: [0,-20],
                        formatter: '{b}',  //标签内容格式器，a：系列名，b:数据名，c：数据值
                        color: '#FFF',
                        fontFamily: 'Arial',
                        borderWidth: 3,
                        backgroundColor: 'rgba(0,23,11,0.3)',
                        padding: [5, 10, 10, 5],
                        lineHeight: 30
                    },
                    itemStyle: {
                        normal: {
                            color: '#FFF'  //散点的颜色
                        }
                    },
                    data:pointsDatav
                }
            );

            //统计飞线数据
            for(var i=0;i<Data.length;i++)
            {
                series.push(
                    {
                        type: 'lines3D',
                        effect: {
                            color: lcolor[Data[i].c],
                            show: true,
                            period: 3,//周期，数值越小越块
                            trailLength: Data[i].v/vtol//尾部阴影，范围0-1，用当前线条v值除以总v值，当前流动占总数的比例
                        },
                        lineStyle: {//航线的视图效果
                            color: lcolor[Data[i].c],
                            width: 1,
                            height:10,
                            opacity: 0.6
                        },
                        data: convertData(Data[i])// 特效的起始、终点位置，一个二维数组，相当于coords: convertData(item[1])
                    })
            }

            myChart.setOption({
                backgroundColor: 'rgba(3,28,72,0.3)',
                title: {
                    show:true
                },
                geo: {
                    type: 'map',
                    map: 'world',
                    left:0,
                    top:0,
                    right: 0,
                    bottom: 0,
                    boundingCoords: [[-180, 90], [180, -90]],
                    zoom:0,
                    roam: false,
                    itemStyle: {
                        borderColor:'#000d2d',
                        normal: {
                            areaColor: '#2455ad',
                            borderColor:'#000c2d'
                        },
                        emphasis: {
                            areaColor: '#357cf8'
                        }
                    },
                    // label:{
                    //     fontSize:24
                    // }
                },
                //考虑到有些小国比较近，不适合直接显示名称标签
                series:dser
            });

            series.push({
                type: 'scatter3D',
                coordinateSystem: 'globe',
                blendMode: 'lighter',
                symbolSize: 2,
                itemStyle: {
                    color: 'rgb(50, 50, 150)',
                    opacity: 0.2
                },
                label: {
                    fontSize:30, //标签的字号
                    show: true,
                    position: [0,-20],
                    formatter: '{b}',  //标签内容格式器，a：系列名，b:数据名，c：数据值
                    // formatter : function (params) {
                    //     return params.name + ':' + params.scale;
                    // },
                    color: '#FFF',
                    fontFamily: 'Arial',
                    borderWidth: 3,
                    backgroundColor: 'rgba(0,23,11,0.3)',
                    padding: [5, 10, 10, 5],
                    lineHeight: 30
                },
                itemStyle: {
                    normal: {
                        color: '#FFF'  //散点的颜色
                    }
                },
                data: pointsData
            });

            //3D地球
            option = {
                backgroundColor: 'rgba(0,0,0,0)',//canvas的背景颜色
                globe: {
                    baseTexture:myChart,
                    top: 'middle',
                    left: 'center',
                    displacementScale: 0,
                    environment:'none',
                    shading: 'color',
                    viewControl: {
                        distance:240,
                        autoRotate: false
                    }
                },
                roam: true,
                series:series,

                tooltip:{
                    trigger: 'item',
                    formatter:'{b}'
                }
            };
            echarts.init(document.getElementById("container")).setOption(option, true);
        });
    </script>
</body>
</html>
